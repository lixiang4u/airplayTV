{{ define "home/info.html" }}
    <!doctype html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Home</title>
        <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.css" rel="stylesheet">

        <style type="text/css">
            body {
                background-color: rgb(223, 239, 221);
            }

            .navbar-header span {
                /*width: 100px;*/
                margin-top: 19px;
                font-size: 12px;
                display: inline-block;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                color: whitesmoke;
                /*line-height: 50px;*/
            }

            .navbar-header span a {
                color: lemonchiffon;
            }

            .h20 {
                width: 100%;
                height: 20px;
                clear: both;
            }

            .video-info .thumb {
                width: 90%;
                margin: 0 auto;
                display: block;
            }

            .video-info .name {
                font-size: 18px;
                font-weight: bold;
                margin-top: 18px;
            }

            .video-info .intro {
                line-height: 180%;
            }

            .video-info .play-list {
                margin: 5px 0 5px 0;
            }

            .video-info .play-list .item {
                background-color: #0c81e8;
                padding: 8px 12px;
                margin: 7px;
                display: inline-block;
                margin-left: 0;
                border-radius: 5px;
                color: #c8dde6;
                text-align: center;
                font-size: 14px;
            }

            .video-info .tips {
                color: red;
                font-size: 12px;
                font-weight: bold;
            }

            .footer {
                text-align: center;
                color: #aaa8a8;
            }

            .footer a {
                color: #797373;
            }

        </style>
    </head>
    <body>

    <div class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand hidden-sm" href="/">ShotTV</a>
                {{ if .tv_id }}
                    <span>
                        ID: {{ .tv_id }}
                        &nbsp;
                        [<a class="unbind" href="?unbind=1">解绑</a>]
                    </span>
                {{ else }}
                    <span>请先扫码关联TV</span>
                {{ end}}
            </div>
        </div>
    </div>

    <div class="container video-info">
        <div class="container">
            <img class="thumb" src="{{ .data.Thumb }}" alt="{{ .data.Name }}">
            <div id="dplayer" hidden="hidden"></div>
        </div>
        <div class="container">
            <p class="name">{{ .data.Name }}</p>
            <p class="tips">如关联了设备，则投射到设备，否则直接播放</p>
            <div class="play-list">
                {{ range .data.Links }}
                    <span class="item" data-id="{{ .Id }}">{{ .Name }}</span>
                {{ end }}
            </div>
            <p class="intro"><b>介绍：</b>{{ .data.Intro }}</p>
        </div>
    </div>

    <div class="h20"></div>

    <p class="footer">资源均网络搜集，<a href="email:18912480313@qq.com">侵权立删</a></p>

    <div class="h20"></div>


    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/hls.js/1.2.0/hls.min.js"></script>
    <!--<script src="https://cdn.bootcdn.net/ajax/libs/dashjs/4.4.1/dash.all.min.js"></script>-->
    <!--<script src="https://cdn.bootcdn.net/ajax/libs/webtorrent/1.8.26/webtorrent.min.js"></script>-->
    <script src="https://cdn.bootcdn.net/ajax/libs/dplayer/1.26.0/DPlayer.min.js"></script>

    <script type="text/javascript">
        $(function () {

            function play(obj) {
                console.log('[playing...]', obj);
                if (obj.video.type == 'auto') {
                    const dp = new DPlayer({
                        container: document.getElementById('dplayer'),
                        autoplay: true,
                        theme: "#00b2c2",
                        video: {
                            url: obj.video.url,
                            type: "auto"
                        },
                    });
                } else {
                    const dp = new DPlayer({
                        container: document.getElementById('dplayer'),
                        video: {
                            url: obj.video.url,
                            autoplay: true,
                            // url:'https://hll.aliyundrive.asia/vtt/movie1/m/03/神偷奶爸3.m3u8',
                            type: 'customHls',
                            customType: {
                                customHls: function (video, player) {
                                    const hls = new Hls();
                                    hls.loadSource(video.src);
                                    hls.attachMedia(video);
                                },
                            },

                        }
                    });
                }
            }


            $('.play-list .item').on('click', function (element) {
                let id = $(this).attr('data-id');

                // 本地播放
                if ("{{ .tv_id }}" == "") {
                    $.ajax({
                        type: 'post',
                        url: '/api/play/info',
                        data: {
                            id: id
                        },
                        dataType: 'json',
                        success: function (data) {
                            console.log(data);

                            $('.video-info .thumb').hide();
                            $('#dplayer').show();

                            play(data.data)
                        }, error: function (a, b, c) {
                            console.log(a, b, c);
                            alert('服务器错误，请稍后');

                        }
                    });
                    return false;
                }

                // 　投屏播放｜远程播放
                $.ajax({
                    type: 'post',
                    url: '/api/play',
                    data: {
                        client_id: '{{ .tv_id }}',
                        id: id
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert('已经发送播放信息到TV，请稍等');
                        console.log(data);
                    },
                    error: function (a, b, c) {
                        alert('网络异常');
                        console.log(a, b, c);
                    }
                });
            });
        })
    </script>

    </body>
    </html>
{{ end }}